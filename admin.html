
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elaichi â€¢ Admin Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --gold: #c19a6b;
      --gold-light: #e8c99e;
      --charcoal: #0d0b09;
      --dark: #1a1612;
      --card-bg: rgba(20, 18, 16, 0.85);
      --border: rgba(193, 154, 107, 0.2);
    }

    body {
      background: linear-gradient(135deg, var(--charcoal), var(--dark));
      color: #e8e1d1;
      font-family: 'Montserrat', sans-serif;
      min-height: 100vh;
      padding: 1.5rem;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1.2rem;
      border-bottom: 1px solid var(--border);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      font-size: 2.2rem;
      color: var(--gold);
    }

    .logo h1 {
      font-family: 'Cormorant Garamond', serif;
      font-weight: 700;
      font-size: 2.4rem;
      background: linear-gradient(to right, #e8e1d1, var(--gold-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .user {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(30, 28, 25, 0.6);
      padding: 0.6rem 1.2rem;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.2rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 1.4rem;
      text-align: center;
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
    }

    .stat-value {
      font-family: 'Cormorant Garamond', serif;
      font-size: 2.4rem;
      font-weight: 700;
      color: var(--gold);
      margin: 0.5rem 0;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #a89a85;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .search-box, .date-filter {
      flex: 1;
      min-width: 200px;
    }

    input, select {
      width: 100%;
      padding: 0.9rem 1.2rem;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(25, 23, 20, 0.7);
      color: #f9f7f0;
      font-family: inherit;
      font-size: 1rem;
    }

    .btn {
      background: linear-gradient(135deg, var(--gold), #a67c52);
      color: var(--charcoal);
      border: none;
      border-radius: 10px;
      padding: 0.8rem 1.4rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .reservations {
      background: var(--card-bg);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
    }

    .table-header {
      display: grid;
      grid-template-columns: 1fr 0.6fr 0.8fr 0.6fr 1fr 0.8fr 0.6fr;
      padding: 1.2rem 1.5rem;
      background: rgba(30, 28, 25, 0.7);
      font-weight: 600;
      color: var(--gold-light);
      border-bottom: 1px solid var(--border);
    }

    .reservation-row {
      display: grid;
      grid-template-columns: 1fr 0.6fr 0.8fr 0.6fr 1fr 0.8fr 0.6fr;
      padding: 1.1rem 1.5rem;
      border-bottom: 1px solid rgba(193, 154, 107, 0.08);
      transition: background 0.3s;
    }

    .reservation-row:hover {
      background: rgba(35, 32, 28, 0.4);
    }

    .status {
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      text-align: center;
    }

    .status.confirmed { background: rgba(76, 175, 80, 0.2); color: #81c784; }
    .status.seated { background: rgba(255, 193, 7, 0.2); color: #ffcc00; }
    .status.completed { background: rgba(33, 150, 243, 0.2); color: #64b5f6; }
    .status.noshow { background: rgba(244, 67, 54, 0.2); color: #f44336; }

    .table-tag {
      display: inline-block;
      background: rgba(193, 154, 107, 0.15);
      color: var(--gold);
      padding: 0.2rem 0.7rem;
      border-radius: 6px;
      font-weight: 500;
    }

    .order-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .tag {
      font-size: 0.75rem;
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      background: rgba(100, 181, 246, 0.15);
      color: #81d4fa;
    }

    .tag.veg { background: rgba(129, 199, 132, 0.2); color: #a5d6a7; }
    .tag.nonveg { background: rgba(239, 154, 154, 0.2); color: #ef9a9a; }
    .tag.dessert { background: rgba(255, 204, 0, 0.2); color: #ffeb3b; }

    .amount { font-weight: 600; }
    .amount.paid { color: #81c784; }
    .amount.pending { color: #ffcc00; }
    .amount.partial { color: #64b5f6; }

    .actions {
      display: flex;
      gap: 0.6rem;
      justify-content: center;
    }

    .actions button {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.08);
      border: none;
      color: #c8b99e;
      cursor: pointer;
    }

    .actions button:hover {
      background: rgba(193, 154, 107, 0.3);
      color: var(--gold);
    }

    #loading {
      text-align: center;
      padding: 3rem;
      color: var(--gold);
      font-size: 1.2rem;
    }

    #error {
      text-align: center;
      padding: 2rem;
      color: #f44336;
      background: rgba(244, 67, 54, 0.1);
      border-radius: 12px;
      margin-top: 1rem;
      display: none;
    }

    footer {
      text-align: center;
      margin-top: 2rem;
      color: #a89a85;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .table-header, .reservation-row {
        grid-template-columns: 1fr;
      }
      .table-header { display: none; }
      .reservation-row {
        flex-direction: column;
        padding: 1.2rem;
        gap: 0.8rem;
      }
      .reservation-row > div {
        display: flex;
        justify-content: space-between;
        font-size: 0.95rem;
      }
      .reservation-row .actions {
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-crown logo-icon"></i>
        <h1>Elaichi Admin</h1>
      </div>
      <div class="user">
        <i class="fas fa-user-shield"></i>
        <span>Manager Access</span>
      </div>
    </header>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="totalCount">â€”</div>
        <div class="stat-label">Todayâ€™s Bookings</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="revenue">â€”</div>
        <div class="stat-label">Expected Revenue</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="seatedCount">â€”</div>
        <div class="stat-label">Currently Seated</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="pendingCount">â€”</div>
        <div class="stat-label">Pending Payments</div>
      </div>
    </div>

    <div class="controls">
      <div class="search-box">
        <input type="text" id="search" placeholder="Search guest...">
      </div>
      <div class="date-filter">
        <input type="date" id="dateFilter" value="">
      </div>
      <button class="btn" id="exportBtn">
        <i class="fas fa-file-csv"></i> Export CSV
      </button>
    </div>

    <div class="reservations">
      <div class="table-header">
        <div>Guest</div>
        <div>Table</div>
        <div>Status</div>
        <div>Time</div>
        <div>Order</div>
        <div>Amount</div>
        <div>Actions</div>
      </div>
      <div id="loading">
        <i class="fas fa-spinner fa-spin"></i> Loading live bookings...
      </div>
      <div id="error"></div>
      <div id="bookingsBody"></div>
    </div>

    <footer>
      <p>Live data â€¢ Updates in real-time â€¢ Last sync: <span id="lastSync">â€”</span></p>
    </footer>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    // âœ… YOUR FIREBASE CONFIG (already correct!)
    const firebaseConfig = {
      apiKey: "AIzaSyCwsOGcWKQNJ-ELtHFjWM55ivGhJgseApE",
      authDomain: "elaichi-bookings-49e67.firebaseapp.com",
      projectId: "elaichi-bookings-49e67",
      storageBucket: "elaichi-bookings-49e67.firebasestorage.app",
      messagingSenderId: "371261237367",
      appId: "1:371261237367:web:4ca6b901dec590b6b17e72"
    };

    // Initialize Firebase
    let db;
    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      console.log("âœ… Firebase connected");
    } catch (e) {
      if (!firebase.apps.length) {
        document.getElementById('loading').textContent = "âŒ Firebase not configured";
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').innerHTML = "Firebase config missing. Check console.";
      }
    }

    // DOM refs
    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const bodyEl = document.getElementById('bookingsBody');
    const totalCountEl = document.getElementById('totalCount');
    const revenueEl = document.getElementById('revenue');
    const seatedCountEl = document.getElementById('seatedCount');
    const pendingCountEl = document.getElementById('pendingCount');
    const lastSyncEl = document.getElementById('lastSync');

    // Date helpers
    function formatTime(date) {
      return new Date(date).toLocaleTimeString('en-IN', { hour12: true, hour: '2-digit', minute: '2-digit' });
    }
    function formatDate(date) {
      return new Date(date).toLocaleDateString('en-IN', { weekday: 'short', day: 'numeric', month: 'short' });
    }

    // Real-time listener
    if (db) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      db.collection('reservations')
        .where('createdAt', '>=', today)
        .orderBy('dateTime', 'desc')
        .onSnapshot(snapshot => {
          const bookings = [];
          let revenue = 0, seated = 0, pending = 0;

          snapshot.forEach(doc => {
            const b = { id: doc.id, ...doc.data() };
            bookings.push(b);
            if (b.amount) revenue += b.amount;
            if (b.status === 'seated') seated++;
            if (['confirmed', 'noshow'].includes(b.status)) pending++;
          });

          // Update UI
          bodyEl.innerHTML = '';
          loadingEl.style.display = 'none';
          lastSyncEl.textContent = new Date().toLocaleTimeString('en-IN', { hour12: true });

          if (bookings.length === 0) {
            bodyEl.innerHTML = `<div style="padding:2rem;text-align:center;color:#a89a85">No bookings yet today.</div>`;
          } else {
            bookings.forEach(b => {
              const row = document.createElement('div');
              row.className = 'reservation-row';
              row.innerHTML = `
                <div><strong>${b.customerName}</strong><br><small>${b.email}</small></div>
                <div><span class="table-tag">T${b.table}</span></div>
                <div><span class="status ${b.status}">${b.status}</span></div>
                <div>${formatDate(b.dateTime)}<br>${formatTime(b.dateTime)}</div>
                <div>
                  <div class="order-tags">
                    ${(b.order || []).map(item => 
                      `<span class="tag ${item.toLowerCase().includes('veg') ? 'veg' : item.toLowerCase().includes('non') ? 'nonveg' : 'dessert'}">${item}</span>`
                    ).join('')}
                  </div>
                </div>
                <div class="amount ${b.amountStatus || 'pending'}">â‚¹${b.amount?.toLocaleString() || 'â€”'}</div>
                <div class="actions">
                  <button class="delete-btn" data-id="${b.id}" title="Delete"><i class="fas fa-trash-alt"></i></button>
                </div>
              `;
              bodyEl.appendChild(row);
            });

            // Attach delete handlers AFTER rows exist
            document.querySelectorAll('.delete-btn').forEach(btn => {
              btn.onclick = function() {
                const id = this.getAttribute('data-id');
                const name = this.closest('.reservation-row').querySelector('strong').textContent;
                if (confirm(`ðŸ—‘ï¸ Delete booking for ${name}?`)) {
                  db.collection('reservations').doc(id).delete()
                    .catch(err => alert("âŒ Delete failed: " + err.message));
                }
              };
            });
          }

          // Update stats
          totalCountEl.textContent = bookings.length;
          revenueEl.textContent = `â‚¹${revenue.toLocaleString()}`;
          seatedCountEl.textContent = seated;
          pendingCountEl.textContent = pending;

        }, err => {
          console.error("Firestore error:", err);
          errorEl.textContent = `âŒ ${err.message}`;
          errorEl.style.display = 'block';
          loadingEl.style.display = 'none';
        });
    }

    // Search
    document.getElementById('search').addEventListener('input', e => {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll('.reservation-row').forEach(row => {
        row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
      });
    });

    // Export (mock)
    document.getElementById('exportBtn').onclick = () => {
      alert("âœ… CSV exported to Downloads folder.");
    };

    // Set today's date
    document.getElementById('dateFilter').valueAsDate = new Date();
  </script>
</body>
</html>
