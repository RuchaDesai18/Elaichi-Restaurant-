
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elaichi • Admin Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --gold: #c19a6b;
      --gold-light: #e8c99e;
      --charcoal: #0d0b09;
      --dark: #1a1612;
      --card-bg: rgba(20, 18, 16, 0.85);
      --border: rgba(193, 154, 107, 0.2);
    }

    body {
      background: linear-gradient(135deg, var(--charcoal), var(--dark));
      color: #e8e1d1;
      font-family: 'Montserrat', sans-serif;
      min-height: 100vh;
      padding: 1.5rem;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1.2rem;
      border-bottom: 1px solid var(--border);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      font-size: 2.2rem;
      color: var(--gold);
    }

    .logo h1 {
      font-family: 'Cormorant Garamond', serif;
      font-weight: 700;
      font-size: 2.4rem;
      background: linear-gradient(to right, #e8e1d1, var(--gold-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .user {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(30, 28, 25, 0.6);
      padding: 0.6rem 1.2rem;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .user i { color: var(--gold); }
    .user span { font-weight: 500; }

    /* Stats Cards */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.2rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
    }

    .stat-value {
      font-family: 'Cormorant Garamond', serif;
      font-size: 2.8rem;
      font-weight: 700;
      color: var(--gold);
      margin: 0.5rem 0;
    }

    .stat-label {
      font-size: 0.95rem;
      color: #a89a85;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .search-box, .date-filter {
      flex: 1;
      min-width: 200px;
    }

    input, select {
      width: 100%;
      padding: 0.9rem 1.2rem;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(25, 23, 20, 0.7);
      color: #f9f7f0;
      font-family: inherit;
      font-size: 1rem;
    }

    input::placeholder { color: #6a6359; }

    .btn {
      background: linear-gradient(135deg, var(--gold), #a67c52);
      color: var(--charcoal);
      border: none;
      border-radius: 10px;
      padding: 0.8rem 1.4rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(166, 124, 82, 0.4);
    }

    /* Reservations Table */
    .reservations {
      background: var(--card-bg);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
    }

    .table-header {
      display: grid;
      grid-template-columns: 0.8fr 1.2fr 0.7fr 1fr 1.5fr 0.8fr 1fr;
      padding: 1.2rem 1.5rem;
      background: rgba(30, 28, 25, 0.7);
      font-weight: 600;
      color: var(--gold-light);
      border-bottom: 1px solid var(--border);
    }

    .reservation-row {
      display: grid;
      grid-template-columns: 0.8fr 1.2fr 0.7fr 1fr 1.5fr 0.8fr 1fr;
      padding: 1.1rem 1.5rem;
      border-bottom: 1px solid rgba(193, 154, 107, 0.08);
      transition: background 0.3s;
    }

    .reservation-row:hover {
      background: rgba(35, 32, 28, 0.4);
    }

    .reservation-row:last-child {
      border-bottom: none;
    }

    .status {
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      text-align: center;
    }

    .status.confirmed { background: rgba(76, 175, 80, 0.2); color: #81c784; }
    .status.seated { background: rgba(255, 193, 7, 0.2); color: #ffcc00; }
    .status.completed { background: rgba(33, 150, 243, 0.2); color: #64b5f6; }
    .status.noshow { background: rgba(244, 67, 54, 0.2); color: #f44336; }

    .table-tag {
      display: inline-block;
      background: rgba(193, 154, 107, 0.15);
      color: var(--gold);
      padding: 0.2rem 0.7rem;
      border-radius: 6px;
      font-weight: 500;
    }

    .order-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .tag {
      font-size: 0.75rem;
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      background: rgba(100, 181, 246, 0.15);
      color: #81d4fa;
    }

    .tag.veg { background: rgba(129, 199, 132, 0.2); color: #a5d6a7; }
    .tag.nonveg { background: rgba(239, 154, 154, 0.2); color: #ef9a9a; }
    .tag.dessert { background: rgba(255, 204, 0, 0.2); color: #ffeb3b; }

    .amount {
      font-weight: 600;
    }

    .amount.paid { color: #81c784; }
    .amount.pending { color: #ffcc00; }
    .amount.partial { color: #64b5f6; }

    .actions {
      display: flex;
      gap: 0.6rem;
    }

    .actions button {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.08);
      border: none;
      color: #c8b99e;
      cursor: pointer;
    }

    .actions button:hover {
      background: rgba(193, 154, 107, 0.3);
      color: var(--gold);
    }

    /* Responsive */
    @media (max-width: 900px) {
      .table-header, .reservation-row {
        grid-template-columns: 1fr 1fr 1fr;
        grid-template-rows: auto;
        gap: 0.8rem;
      }
      .table-header { display: none; }
      .reservation-row {
        flex-direction: column;
        padding: 1.2rem;
      }
      .reservation-row > div {
        display: flex;
        justify-content: space-between;
        font-size: 0.95rem;
      }
      .reservation-row > div:first-child::before { content: "Guest:"; font-weight: 600; }
      .reservation-row > div:nth-child(2)::before { content: "Table / Time:"; font-weight: 600; }
      .reservation-row > div:nth-child(3)::before { content: "Order / Amount:"; font-weight: 600; }
      .actions { justify-content: flex-end; }
    }

    footer {
      text-align: center;
      margin-top: 2rem;
      color: #a89a85;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-crown logo-icon"></i>
        <h1>Elaichi Admin</h1>
      </div>
      <div class="user">
        <i class="fas fa-user-circle"></i>
        <span>Manager • Ruchaa</span>
      </div>
    </header>

    <!-- Stats -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-value">14</div>
        <div class="stat-label">Today’s Reservations</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">₹28,450</div>
        <div class="stat-label">Expected Revenue</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">8</div>
        <div class="stat-label">Tables Occupied</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">5</div>
        <div class="stat-label">Pending Payments</div>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls">
      <div class="search-box">
        <input type="text" id="search" placeholder="Search guest name or table...">
      </div>
      <div class="date-filter">
        <input type="date" id="dateFilter" value="2025-11-07">
      </div>
      <button class="btn" id="exportBtn">
        <i class="fas fa-file-csv"></i> Export CSV
      </button>
    </div>

    <!-- Reservations Table -->
    <div class="reservations">
      <div class="table-header">
        <div>Guest</div>
        <div>Table</div>
        <div>Status</div>
        <div>Time</div>
        <div>Order Summary</div>
        <div>Amount</div>
        <div>Actions</div>
      </div>

      <!-- Reservation Rows (Mock Data) -->
      <div class="reservation-row">
        <div><strong>Ananya Patel</strong><br><small>ananya.p@gmail.com</small></div>
        <div><span class="table-tag">T5 (4-seater)</span></div>
        <div><span class="status confirmed">Confirmed</span></div>
        <div>7:30 PM</div>
        <div>
          <div class="order-tags">
            <span class="tag veg">Paneer Tikka</span>
            <span class="tag nonveg">Butter Chicken</span>
            <span class="tag dessert">Gulab Jamun</span>
          </div>
        </div>
        <div class="amount pending">₹3,200 <small>(Pending)</small></div>
        <div class="actions">
          <button title="Mark Paid"><i class="fas fa-check"></i></button>
          <button title="View Details"><i class="fas fa-eye"></i></button>
        </div>
      </div>

      <div class="reservation-row">
        <div><strong>Rajesh Mehta</strong><br><small>rajesh.m@gmai.com</small></div>
        <div><span class="table-tag">T2 (2-seater)</span></div>
        <div><span class="status seated">Seated</span></div>
        <div>8:00 PM</div>
        <div>
          <div class="order-tags">
            <span class="tag veg">Dal Makhani</span>
            <span class="tag nonveg">Tandoori Prawns</span>
          </div>
        </div>
        <div class="amount paid">₹2,850 <small>(Paid)</small></div>
        <div class="actions">
          <button title="Receipt"><i class="fas fa-receipt"></i></button>
          <button title="View Details"><i class="fas fa-eye"></i></button>
        </div>
      </div>

      <div class="reservation-row">
        <div><strong>Priya & Family</strong><br><small>priya.singh15@gmail.com</small></div>
        <div><span class="table-tag">T9 (8-seater)</span></div>
        <div><span class="status completed">Completed</span></div>
        <div>6:45 PM</div>
        <div>
          <div class="order-tags">
            <span class="tag veg">6x Veg Thali</span>
            <span class="tag nonveg">4x Non-Veg Thali</span>
            <span class="tag dessert">Kheer (x4)</span>
          </div>
        </div>
        <div class="amount paid">₹9,600 <small>(Paid)</small></div>
        <div class="actions">
          <button title="Receipt"><i class="fas fa-receipt"></i></button>
          <button title="Feedback"><i class="fas fa-comment"></i></button>
        </div>
      </div>

      <div class="reservation-row">
        <div><strong>Vikram Oberoi</strong><br><small>v.oberoi1@gmail.com</small></div>
        <div><span class="table-tag">T1 (Private)</span></div>
        <div><span class="status noshow">No-Show</span></div>
        <div>9:00 PM</div>
        <div>
          <div class="order-tags">
            <span class="tag">Tasting Menu</span>
            <span class="tag">Wine Pairing</span>
          </div>
        </div>
        <div class="amount pending">₹12,500 <small>(Pending)</small></div>
        <div class="actions">
          <button title="Call Guest"><i class="fas fa-phone"></i></button>
          <button title="Cancel"><i class="fas fa-times"></i></button>
        </div>
      </div>

      <div class="reservation-row">
        <div><strong>Neha Desai</strong><br><small>neha.d@gmail.com</small></div>
        <div><span class="table-tag">T7 (4-seater)</span></div>
        <div><span class="status seated">Seated</span></div>
        <div>8:30 PM</div>
        <div>
          <div class="order-tags">
            <span class="tag veg">Chole Bhature</span>
            <span class="tag dessert">Rasmalai</span>
          </div>
        </div>
        <div class="amount partial">₹1,800 <small>(Partial)</small></div>
        <div class="actions">
          <button title="Add Payment"><i class="fas fa-plus"></i></button>
          <button title="Bill"><i class="fas fa-file-invoice"></i></button>
        </div>
      </div>
    </div>

    <footer>
      <p>Elaichi Admin Dashboard • Updated in real-time • Last sync: 8:47 PM</p>
    </footer>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    // ✅ STEP 1: REPLACE WITH YOUR FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyCwsOGcWKQNJ-ELtHFjWM55ivGhJgseApE",
      authDomain: "elaichi-bookings-49e67.firebaseapp.com",
      projectId: "elaichi-bookings-49e67",
      storageBucket: "elaichi-bookings-49e67.firebasestorage.app",
      messagingSenderId: "371261237367",
      appId: "1:371261237367:web:4ca6b901dec590b6b17e72"
    };

    // Initialize Firebase
    let db;
    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore(); // ✅ Define db here
      console.log("✅ Firebase connected");
    } catch (e) {
      if (!firebase.apps.length) {
        document.getElementById('loading').textContent = "❌ Firebase not configured";
        document.getElementById('error').innerHTML = `Please add your Firebase config in the script.<br>See instructions: <a href="#" onclick="alert('1. Go to Firebase Console → Project Settings → Web App\\n2. Copy config into firebaseConfig above')">?</a>`;
        document.getElementById('error').style.display = 'block';
      }
    }

    // DOM elements
    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const bodyEl = document.getElementById('bookingsBody');
    const totalCountEl = document.getElementById('totalCount');
    const revenueEl = document.getElementById('revenue');
    const seatedCountEl = document.getElementById('seatedCount');
    const pendingCountEl = document.getElementById('pendingCount');

    // Helper: Format date/time
    function formatDateTime(date) {
      if (!date) return '—';
      const d = date.toDate ? date.toDate() : new Date(date);
      return d.toLocaleTimeString('en-IN', {
        hour12: true,
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function formatDate(date) {
      if (!date) return '—';
      const d = date.toDate ? date.toDate() : new Date(date);
      return d.toLocaleDateString('en-IN', {
        weekday: 'short',
        day: 'numeric',
        month: 'short'
      });
    }

    // Listen for real-time bookings
    if (db) { // ✅ Only run if db is defined
      const todayStart = new Date();
      todayStart.setHours(0, 0, 0, 0);

      db.collection('reservations')
        .where('createdAt', '>=', todayStart)
        .orderBy('dateTime', 'desc')
        .onSnapshot(snapshot => {
          const bookings = [];
          let totalRevenue = 0;
          let seated = 0;
          let pending = 0;

          snapshot.forEach(doc => {
            bookings.push({ id: doc.id, ...doc.data() });
          });

          // Clear UI
          bodyEl.innerHTML = '';
          loadingEl.style.display = 'none';

          if (bookings.length === 0) {
            bodyEl.innerHTML = `<div style="padding:2rem;text-align:center;color:#a89a85">No bookings today yet.</div>`;
          } else {
            bookings.forEach(b => {
              if (b.amount) totalRevenue += b.amount;
              if (b.status === 'seated') seated++;
              if (b.status === 'confirmed' || b.status === 'noshow') pending++;

              const row = document.createElement('div');
              row.className = 'reservation-row';

           row.innerHTML = `
  <div>
    <strong>${b.customerName || '—'}</strong><br>
    <small>${b.email || '—'}</small>
  </div>
  <div>T${b.table || '—'}</div>
  <div>${formatDate(b.dateTime)}<br>${formatDateTime(b.dateTime)}</div>
  <div>${b.guests || '—'}</div>
  <div><span class="status ${b.status || 'confirmed'}">${b.status || '—'}</span></div>
  <div class="amount ${b.amountStatus || 'pending'}">
    ₹${b.amount ? b.amount.toLocaleString() : '—'}
    ${b.amountStatus ? `<br><small>(${b.amountStatus})</small>` : ''}
  </div>
  <div style="display:flex;gap:8px;justify-content:center">
    <button class="delete-btn" data-id="${b.id}" title="Delete booking">
      <i class="fas fa-trash-alt" style="color:#f44336"></i>
    </button>
  </div>
`;
// Attach delete handlers to all delete buttons
document.querySelectorAll('.delete-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const bookingId = this.getAttribute('data-id');
    const guestName = this.closest('.reservation-row').querySelector('strong').textContent;

    if (confirm(`⚠️ Delete booking for ${guestName}? This cannot be undone.`)) {
      db.collection('reservations').doc(bookingId).delete()
        .then(() => {
          console.log("✅ Booking deleted:", bookingId);
        })
        .catch(err => {
          console.error("❌ Delete failed:", err);
          alert("Failed to delete. Check console.");
        });
    }
  });
});
              bodyEl.appendChild(row);
            });
          }

          // Update stats
          totalCountEl.textContent = bookings.length;
          revenueEl.textContent = `₹${totalRevenue.toLocaleString()}`;
          seatedCountEl.textContent = seated;
          pendingCountEl.textContent = pending;

        }, err => {
          console.error("Firestore error:", err);
          loadingEl.style.display = 'none';
          errorEl.textContent = `❌ Failed to load bookings: ${err.message}`;
          errorEl.style.display = 'block';
        });
    } else {
      loadingEl.style.display = 'none';
      errorEl.textContent = "❌ Firebase database not initialized.";
      errorEl.style.display = 'block';
    }
  </script>
</body>
</html>